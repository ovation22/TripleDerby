name: CI

on:
    push:
        branches: [ main ]
    pull_request:
        branches: [ main ]

jobs:
    build:
        runs-on: ubuntu-latest
        
        steps:
        - name: Checkout code
          uses: actions/checkout@v5
            
        - name: Setup .NET
          uses: actions/setup-dotnet@v5
          with:
            dotnet-version: '9.0.x'
                
        - name: Restore dependencies
          run: dotnet restore
            
        - name: Build
          run: dotnet build --no-restore --configuration Release
            
        - name: Run tests with coverage
          run: dotnet test --configuration Release --no-build --logger "trx" --results-directory ./TestResults --collect:"XPlat Code Coverage"
            
        - name: Publish test results
          uses: EnricoMi/publish-unit-test-result-action@v2
          if: always()
          with:
            files: TestResults/**/*.trx