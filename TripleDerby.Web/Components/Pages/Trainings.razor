@page "/trainings"
@rendermode @(new InteractiveServerRenderMode(prerender: false))

@using TripleDerby.SharedKernel
@using TripleDerby.Web.ApiClients.Abstractions

@inject ITrainingsApiClient TrainingsApi

<PageTitle>Trainings</PageTitle>

<h1>Training Types</h1>

@if (_loading)
{
    <FluentProgressRing />
    <p>Loading trainings...</p>
}
else if (_trainings == null || !_trainings.Any())
{
    <FluentMessageBar Intent="@MessageIntent.Info">
        No training types available.
    </FluentMessageBar>
}
else
{
    <FluentDataGrid Items="@_trainings.AsQueryable()"
                    TGridItem="TrainingsResult"
                    GridTemplateColumns="1fr 2fr"
                    ShowHover="true">
        <PropertyColumn Property="@(t => t.Name)" Title="Name" Sortable="true" InitialSortDirection="SortDirection.Ascending" IsDefaultSortColumn="true" />
        <PropertyColumn Property="@(t => t.Description)" Title="Description" Sortable="true" />
    </FluentDataGrid>
}

@code {
    private List<TrainingsResult>? _trainings;
    private bool _loading = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadData();
    }

    private async Task LoadData()
    {
        _loading = true;
        _trainings = await TrainingsApi.GetAllAsync();
        _loading = false;
        await InvokeAsync(StateHasChanged);
    }
}
